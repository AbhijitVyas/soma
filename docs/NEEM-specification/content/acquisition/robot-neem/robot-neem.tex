\section{Narrative Enabled Episodic Memories for Robotic Agents}
\label{sec:robot-neem}
\lstset{style=lispcode}
This section focuses on describing how to generate \neems from experiments performed by the robot. 

\subsection{Prerequisite}

Before you are intending to generate your episodic memories, make sure you are familiar with the Cognitive Robot Abstract Machine (\cram)\footnote{\url{http://cram-system.org/cram}} system and installed it on your machine.
\cram is a cognitive-enabled planning framework which allows to design high-level plan for robots.\todo{@Seba: Add more detailed description}
This section requires that your robot plan is written in \cram to be able to generate \neems.
However, once you are familiar with our planning and logging components, you will be able to port those components to your preferred planning tool.

In addition to having a valid \cram plan, you will need the following software components to be installed:
\begin{itemize}
	\item A MongoDB server with at least version 3.4.10\footnote{\url{https://www.mongodb.com/}}
	\item \knowrob\footnote{\url{https://github.com/knowrob/knowrob}}
	\item \soma ontology\footnote{\url{https://github.com/ease-crc/soma}}
	\item \cram ontology\footnote{\url{https://github.com/ease-crc/cram\_knowledge}}
\end{itemize}


\subsection{Recording Narrative Enabled Episodic Memories}
Our recording mechanism  captures every executed \cram action and its parameter.
In addition, the logger puts the actions in relation to each other by creating a hierarchy which is described in Section \ref{ch:narrative,sec:actionHierarchy}.

Before you can begin to record your own \neems, you need to include the "cram-cloud-logger" package into your \cram plan.
After you included the package, you need to enable the logging via:


\begin{lstlisting}[language=lisp, caption=Enabling \neem Logging in a \cram plan]
	(setf ccl::*is-logging-enabled* t)
\end{lstlisting}

The only things left to do start the logging before the plan execution and after the execution to finishing it.
It can look like the following:
\begin{lstlisting}[language=lisp, caption=Steps to Record an Episode for a \cram Plan]
	(ccl::start-episode)
	(urdf-proj:with-simulated-robot (demo::demo-random nil ))
	(ccl::stop-episode)
\end{lstlisting}
	
The generate \neem will be stored per default in "\raisebox{-0.9ex}{\~{}}/knowrob-memory".
Keep in mind to  have \knowrob launched before starting the \neem recording. 
You can start \knowrob via:

\begin{lstlisting}[language=bash, caption=How to Start \knowrob]
	roslaunch knowrob_memory knowrob.launch
\end{lstlisting}

\subsection{Data}
After you generate your first \neem~you will find a folder with a timestamp store in the "~/knowrob-memory" folder (per default).
This folder contains the \neemnar and \neemexp . The \neemnar is represented in the "beliefstate.owl". The triple store and the \neemexp are stored in the "roslog" folder. The triple store is stored in the "triples.bson". The other bsons files are presentening the logged rostopics. More about the rostopics is stated in Section \todo{put reference to rostopic section}

\subsection{Log own designed plans}
The disadvantage of having a strong semantic knowledge representation is that our ontology.
Currently, we focused on the support on setting-up and cleaning-up a table.
If you want for instance create \neems for an autonomous car, you will need to extend the \ease ontologies and the logger with your required actions, parameters etc.
In the following subsection, we will describe how you can add the required stuff so they are semantical log.
In general, please feel free to share your changes with us in form of an pull request to our repositories.
So we can provide you feedback and your help us to extend the features

\subsubsection{Adding New Tasks}
The most obvious requirement is to define your tasks.
A task might be something like cutting, stopping or accelerating.
To be able to semantaclly log the task, you will need first define the task in the \easeAct.
Make sure that the new action is a child of the \textit{CommunicationTask}, \textit{MentalTask} or \textit{PhysicalTask}.
If you will try to log unknown task, there will be logged as \textit{PhysicalTask}.
The \textit{PlanExecution} instance pointing to that \textit{PhysicalTask} , will have a comment attached with the statement "Unknown Action: <CRAM-ACTION-NAME>".
After you add the new action to the ontology, please open the "knowrob-action-name-handler.lisp" in the cram-cloud-logger package and add your new action in the format "(CRAM-ACTION-NAME EASE-ONTOLOGY-NAME)".
If this step you added successfully the support of the new action to the logger.

\subsubsection{Adding New Objects}
Unknown object will be logged as \textit{DesignedArtifact} with the comment attached "Unknown Object: CRAM-OBJECT-TYPE"
To add your object to the ontology, you need to add it in the \easeObj.
Afterwards, open the "utils-for-perform.lisp" in the 
cram-cloud-logger package and include the new object in the hash table generate in "get-ease-object-lookup-table" where the key is the CRAM-OBJECT-TYPE and the value is the uri to the object concept created in \easeObj.

\subsubsection{Adding New Failure}
Unknown failures will be logged as \textit{Failure} with the comment attached "Unknown failure: CRAM-FAILURE-NAME".
To integrate your new \cram failures in to the ontology, you need to add your new failures into the \cramOwl.
Afterwards, open "failure-handler.lisp" in the cram-cloud-logger package and your new action in the format "(CRAM-FAILURE-NAME CRAM-ONTOLOGY-NAME)".	

\subsubsection{Adding New Rostopic}
Per default, we log the rostopics \tf and tf\_static.
If you need to log additional topics, open "memory.pl" in the "knowrob\_memory" package from \knowrob and include your topic in the "mem\_episode\_start(Episode)" function.
After the \neem generation, the data will be stored in the created \neem folder under the file "roslog/<rostopic>.bson".

\subsubsection{Adding New Parameters}
Unknown parameters will be logged as comment attached to the corresponding \textit{PlanExecution} instance.
The comment statement "Unknown Parameter: PARAMETER-NAME  -\#\#\#\#- PARAMETER-VALUE/>"
The current parameter types are represented 

\todo{@Ontology group: Please make sure that is available in the ontology }

\begin{enumerate} 
	\item Integer/Floats
	\item Posen
	\item Spatial Relations
	\item Link to entities of other ontologies such as http://knowrob.org/kb/PR2.owl\#pr2\_right\_arm
\end{enumerate}

Before you want to model your parameter what data type your parameter is.
If it is a complex object, you need to consider how you want to to represent it an the ontology.
For simpler representaion such has a discrete domain representation, you might represented as the domain values as \textit{Region} and add the model the parameter as a subconcept of \textit{Parameter}.
More information about the concepts \textit{Region} and \textit{Parameter} can be found in \todo{ reference to Region and parameter}.


\subsection{Adding New Reasoning Tasks}
\todo{@Ontology group: How to log the result of the reasoning query ?}



\section{Next steps}
After you have generate your \neem, you can use the tool \todo{Add neem2narrative} to generate an cvs file for your \neem.
Keep in mind that the csv is a abstraction of \neemnar and can be used to make data-mining on explicit knowledge.
For more sophisticated analysis, you will need to use \knowrob. 
We use this general analysis to identify bottlenecks in our plan execution.
We also showed that with a collection of \neems we are able to improve the robot's performance.
\todo{Af}
The tools for the feature extraction can be found here \todo{Add link}
Now that you we encourage you to generate your \neems and share them via our \neemhub.

\input{content/acquisition/robot-neem/example}
