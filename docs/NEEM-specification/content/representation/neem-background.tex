
\chapter{NEEM-Background}
\label{ch:background}
\chapterauthor{D. Be{\ss}ler, M. Pomarlan, A. Vyas}

The \neembak represents the (physical) context of \neems.
More concretely, the \neembak represents the environment where events took place, and the agents that are involved.
These are representations of physical objects, their parts, properties, and relationships between them.

Each \neem must have exactly one associated \neembak.
This is important as only the objects and their properties represented in the \neembak may be involved in events that occur in \neems.
Consider, for example, a robot fetching a cup in a kitchen environment to prepare a coffee.
The cup would be part of the \neembak while the fetching event carried out by the robot would be represented in the \neemnar (Chapter~\ref{ch:narrative}).

The way how a task can be solved best depends on what is available in the environment.
The suitability of an object to be used to perform a certain task is often derived from the class of objects it belongs to, e.g., that a knife can be used for cutting.
The \neem model defines a set of more general object classes such as \emph{agent} and \emph{artifact} (Section~\ref{sec:background:types}).
These are used to classify each object represented in the \neembak.
%
The usability of an object is, however, ultimately grounded in its properties, and, e.g., a dulled knife may proof to be unusable to perform a cutting task.
It is thus also relevant to characterize object properties as they correlate with how an agent may solve its task.
Consequently, we treat types of object properties as classes organized in a taxonomy (Section~\ref{sec:background:properties}).

\neems may characterize different aspects of the environment depending on what information is accessible when the \neem is acquired.
We organize different characteristics in so called \emph{views} (Section~\ref{sec:background:views}).
Each view has its own set of types and relationships to represent the environment from a specific viewpoint such as appearance or kinematics.

\neems are heterogenous representations that may include additional data files.
These are, first of all, time series data bases that are annotated by the \neemnar.
In adddition, some widely used data formats for the representation of objects are supprted (Section~\ref{sec:background:formats}).
Such data files may be stored within the \neembak, associated to objects it represents, and used to enrich knowledge about the environment.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Types of Objects}
\label{sec:background:types}

Objects and agents that appear in an environment are classified as \emph{physical objects}.
Physical objects are exactly the objects you can point on, as they have a location in space.

The most common physical objects in non-natural environments are \emph{artifacts}.
An artifact is an item that has certain structure, often to serve a particular purpose such as to use it in a certain way, or to enjoy looking at it in case of, e.g., an art piece.
Artifacts that were created with a purpose in mind are called \emph{designed artifacts}.
Most objects in human-made environments belong to this category.
Note that, e.g., a \emph{container} is not a designed artifact, as also objects that were not designed as such may serve as container.
Consequently, the class \emph{designed container} is used for the objects that were designed to be used as a container.
Other examples of designed artifacts are \emph{tools} and \emph{appliances} designed for specific tasks or agents, and \emph{components} designed to fit together to form a larger whole.

Another category of objects are \emph{physical bodies}.
Most commonly one would use this category for \emph{substances} that appear in the environment such as a blob of dough, or the coffee inside of a cup.
However, it is more appropiate to classify the substance as \emph{designed substance} in case it was created with a purpose in mind which is, e.g., the case for the dough that is made according to a recipe, and supposed to be eaten after being baked.

Agents that appear in a \neem are classified as \emph{physical agents}.
The difference to other types of objects is that agents have intentions, execute actions, and attempt to achieve goals, e.g., by following a plan and moving their body in a way to generate interactions with the environment to cause intended effects.
Each agent is composed of \emph{body parts} organized in a skeletal structure. \todo{there is no class body part}
Interactions with the environment are carried out through \emph{effectors} such as arms, legs, or hands.
Effectors that are used for grasping are called \emph{prehensile effectors}.

The last top-level category in our object taxonomy is \emph{physical place}.
Places are objects with a specific location such as the surface of a table, or the campus of the University.
Each \neem refers at least to the place where it was acquired, which is usually a room in a building with objects that can be used to perform certain everyday tasks.
%
\todo{show object taxonomy Figure}
\todo{provide details about e.g. how many labels are available?}

%According to \dul~\footnote{\url{http://www.ontologydesignpatterns.org/ont/dul/DUL.owl}} upper level ontology, an object participates in an event during its lifetime and has its own spatial location. During an everyday activity, we come across many objects which are mainly of physical type. A physical object is defined as an object that has a proper space region and associated mass. Sub-classes of physical objects are dirty object, physical agent, physical artifact, physical body, physical space, and physical effector. A typical object participate in an event and can be classified by role. It can have physical qualities such as color, localization, disposition, capacity, shape, size, and temperature that are aspect of an object dependent on its physical manifestation. 

%An object branch also covers a design taxonomy which considers functional, structural and aesthetic aspect of object design. Designs are useful to support an agent to hypothesize unknown functions that can be served by an entity\todo{Seba; What exactly is en entity ? An object ? an instance of a concept ?}. A design describes objects which host a common design relevant qualities such as, dispositional, geometrical, and aesthetic. An intelligent agent would be able to infer based on dispositional quality of an object if it can be used to serve other function in everyday task. For example, a heavy door stopper would also be able to function as paper weight or a dining table can be also used as ping pong table based on appropriate dimensions.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Properties of Objects}
\label{sec:background:properties}

Qualities are the properties of an object that are not part of it, but cannot exist without it.
This is, for example, the quality of having a shape -- a quality inherited by all physical objects.
Another example is the quality of a floor being slippery.
A robot navigating on such a floor could use this knowledge to avoid, for example,
spillage when moving on the floor with a coffee-filled cup.
The quality concept does not directly encode the value of the object property, but only focusses on characteristics of the property itself.
This is mainly useful in cases where individual aspects of an entity are considered in the domain of discourse.

\begin{ODP}{Object Qualities}
	\ODPINTENT{To represent the qualities of an object.}
	\ODPDEFINEDIN{DUL.owl}
	\ODPQUESTION{What qualities does this object have? What objects have this quality?}
	\ODPGRAPHIC{
	\begin{tikzpicture}
	    \node[owlclass] (A) {Object};
	    \node[owlclass,below=0.6cm of A] (B) {Quality};
	    \draw (A) edge[relationxl] node[midway,label=left:hasQuality] {} (B);
	    \draw (B) edge[relationxr] node[midway,label=right:isQualityOf] {} (A);
 %\node[owlclass] (QUALITY) {
 %\begin{owlclass}{Quality}
 % \item $(\exists \emph{isQualityOf}.\texttt{Entity})$
 % \item $(\exists \emph{hasRegion}.\texttt{Region})$
 %\end{owlclass}
 %};
 %\node[owlclass,below=0.6cm of QUALITY] (REGION) {
 %\begin{owlclass}{Region}
 % \item $(\exists \emph{isRegionFor}.\texttt{Quality})$
 %\end{owlclass}
 %};
 %\draw (QUALITY) edge[thick,-,dashed,blue!60] (REGION);
	\end{tikzpicture}
	}
	%% Example KnowRob language expressions
	\ODPEXAMPLES{
		\emph{has\_quality($x$,$y$)} &
		$y$ is a quality of $x$
	}
\end{ODP}

Each object property has one value at a time. The value of an object property is called \emph{region}.
The value itself is an element, or a sub-region in some dimensional
space such as \emph{time interval} or \emph{space region}.\todo{Seba: Are those concept names? If not, we should not put those in emph and rather pick another formating style.}
A region may be a finite set of discrete labels, allowing for ``qualitative'' descriptions,
but more often a region is some dimensional space allowing ``quantitative'' descriptions.
A Region may contain a single point, in cases where the value of a property is known precisely.
Note that the domain of the relation \emph{hasRegion} is not \emph{Quality} but \emph{Entity}.
This is to allow assigning regions to entities without explicating the quality as a concept (quality-as-relation).
\todo{Seba: maybe some more example would be nice. Or refering to the example with the slippery floor. }

\begin{ODP}{Regions}
	\ODPINTENT{To represent values of attributes of things.}
	\ODPDEFINEDIN{DUL.owl}
	\ODPQUESTION{What is the value for the attribute of that entity? Which entities have a certain value on that parameter/attribute/feature?}
	\ODPGRAPHIC{
	\begin{tikzpicture}
	    \node[owlclass] (A) {Entity};
	    \node[owlclass,below=0.6cm of A] (B) {Region};
	    \node[data,below=0.6cm of B] (C) {XSD Type};
	    \draw (A) edge[relation] node[midway,label=right:hasRegion] {} (B);
	    \draw (B) edge[relation] node[midway,label=right:hasRegionDataValue] {} (C);
	\end{tikzpicture}
	}
	%% Example KnowRob language expressions
	\ODPEXAMPLES{
		\emph{has\_region($x$,$y$)} &
		$y$ is a region of $x$ \\
		% % % % %
		\emph{has\_data\_value($x$,$y$)} &
		$y$ is a data value of $x$ 
	}
\end{ODP}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Views on Objects}
\label{sec:background:views}

The \neembak may represent several different \emph{views} on the same object highlighting different characteristics that are fused in the \neembak to form a more complete representation of the environment.
Each view has its own vocabulary to describe objects including view-specific types of objects, qualities, and relations, and has a distinct set of competency questions that may be answered in case a \neem represents the view.
A \neem may not represent each supported view, however, it is recommended to represent as many as possible.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Appearance}

\todo{TODO: Mihai: explain how EASE researcher may represent appearance of objects}

\lipsum[2]

\begin{ODP}{Shape}
	\ODPINTENT{To represent the shape of physical objects.}
	\ODPDEFINEDIN{SOMA.owl}
	\ODPQUESTION{What is the shape of this object? Which objects have this shape?}
	\ODPGRAPHIC{
	\begin{tikzpicture}
	    \node[owlclass] (A) {Physical Object};
	    \node[owlclass,below=0.6cm of A] (B) {Shape};
	    \node[owlclass,below=0.6cm of B] (C) {Shape Region};
	    \draw (A) edge[relationxl] node[midway,label=left:hasShape] {} (B);
	    \draw (B) edge[relationxr] node[midway,label=right:isShapeOf] {} (A);
	    \draw (B) edge[relationxl] node[midway,label=left:hasShapeRegion] {} (C);
	    \draw (C) edge[relationxr] node[midway,label=right:isShapeRegionOf] {} (B);
	\end{tikzpicture}
	}
	%% Example KnowRob language expressions
	\ODPEXAMPLES{
		\emph{object\_dimensions($x$,$d$,$w$,$h$)} &
		$d,w,h$ are the depth,width,height of the bounding box of $x$ \\
		% % % % %
		\emph{object\_shape($x$,$s$,$o$)} &
		$s$ is the data of a shape of $x$ located at $o$
	}
\end{ODP}

\lipsum[2]
\todo{TODO: write about how appearance of objects is represented}

\begin{ODP}{Color}
	\ODPINTENT{To represent the color of physical objects.}
	\ODPDEFINEDIN{SOMA.owl}
	\ODPQUESTION{What is the color of this object? Which objects have this color?}
	\ODPGRAPHIC{
	\begin{tikzpicture}
	    \node[owlclass] (A) {Physical Object};
	    \node[owlclass,below=0.6cm of A] (B) {Color};
	    \node[owlclass,below=0.6cm of B] (C) {Color Region};
	    \draw (A) edge[relationxl] node[midway,label=left:hasColor] {} (B);
	    \draw (B) edge[relationxr] node[midway,label=right:isColorOf] {} (A);
	    \draw (B) edge[relationxl] node[midway,label=left:hasColorRegion] {} (C);
	    \draw (C) edge[relationxr] node[midway,label=right:isColorRegionOf] {} (B);
	\end{tikzpicture}
	}
	%% Example KnowRob language expressions
	\ODPEXAMPLES{
		\emph{object\_color\_rgb($x$,$[r,g,b]$)} &
		$r,g,b$ is the RGB color data of $x$
	}
\end{ODP}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Components}

\lipsum[2]
\todo{TODO: write about how components of objectsare represented}

\begin{ODP}{Composition}
	\ODPINTENT{To represent proper parthood of objects.}
	\ODPDEFINEDIN{DUL.owl}
	\ODPQUESTION{What is this object component of? What are the components of this object?}
	\ODPGRAPHIC{
	\begin{tikzpicture}
	    \node[owlclass] (A) {Physical Object};
	    \node[owlclass,below=0.6cm of A] (B) {Physical Object};
	    \draw (A) edge[relationxl] node[midway,label=left:hasComponent] {} (B);
	    \draw (B) edge[relationxr] node[midway,label=right:isComponentOf] {} (A);
	\end{tikzpicture}
	}
	%% Example KnowRob language expressions
	\ODPEXAMPLES{
		\emph{has\_component($x$,$y$)} &
		$y$ is a proper part of $x$
	}
\end{ODP}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Kinematics}

Kinematics, also often referred to as \emph{geometry of motion}, describes how objects may move without considering the influence of forces.
The kinematic state of an object is represented using a set of object properties such as its position, velocity and acceleration.
However, objects often can not move freely but are constrained in their movement with respect to some reference object.
This is, for example, the case for walls without doors preventing movement from one room to another, or for two objects that are attached to each other via a \emph{joint} and thus restricting movement relative to each other (kinematic coupling).
Kinematically coupled objects are often part of a bigger hierarchical structure, and one of the linked objects, the parent link of the joint, is the one closer to the root of the structure then the child link of the joint.

\begin{ODP}{Joints}
	\ODPINTENT{To represent how parts are attached to each other via a joint.}
	\ODPDEFINEDIN{SOMA.owl}
	\ODPQUESTION{Is there a joint between these objects? What objects are connected by this joint?}
	\ODPGRAPHIC{
	\begin{tikzpicture}
	    \node[owlclass] (A) {Physical Object};
	    \node[owlclass,below=0.6cm of A] (B) {Joint};
	    \node[owlclass,below=0.6cm of B] (C) {Physical Object};
	    \draw (A) edge[relationxl] node[midway,label=left:isParentLinkOf] {} (B);
	    \draw (B) edge[relationxr] node[midway,label=right:hasParentLink] {} (A);
	    \draw (B) edge[relationxl] node[midway,label=left:hasChildLink] {} (C);
	    \draw (C) edge[relationxr] node[midway,label=right:isChildLinkOf] {} (B);
	\end{tikzpicture}
	}
	%% Example KnowRob language expressions
	\ODPEXAMPLES{
		\emph{xxx\_xxxxx($x$,$y$)} &
		\textbf{todo}
	}
\end{ODP}

The pattern above is used to represent kinematical structures, however these representations must also be linked to the various typed objects that are represented in the \neembak.
Such objects may be referred to directly in kinematical structures in case of not being composed of movable parts.
In the case of having movable parts, the object corresponds to chains of links connected via joints in the kinematics representation.
This is, for example, that the kinematical chain from shoulder to wrist forms an arm component.
Each object has exactly one root link, but may have many end links such as a hand component having its root in the wrist, and ending at each finger tip.
\todo{Seba:Is there a connection to the URDF files or are the joints described only in the ontology?}
\begin{ODP}{Component Chains}
	\ODPINTENT{To represent objects as chains of parts.}
	\ODPDEFINEDIN{SOMA.owl}
	\ODPQUESTION{What is the base link of this object? What are the end links of this object?}
	\ODPGRAPHIC{
	\begin{tikzpicture}
	    \node[owlclass] (A) {Physical Object};
	    \node[owlclass,below=0.6cm of A] (B) {Physical Object};
	    \node[owlclass,below=0.6cm of B] (C) {Physical Object};
	    \draw (A) edge[relationxl] node[midway,label=left:isRootLinkOf] {} (B);
	    \draw (B) edge[relationxr] node[midway,label=right:hasRootLink] {} (A);
	    \draw (B) edge[relationxl] node[midway,label=left:hasEndLink] {} (C);
	    \draw (C) edge[relationxr] node[midway,label=right:isEndLinkOf] {} (B);
	\end{tikzpicture}
	}
	%% Example KnowRob language expressions
	\ODPEXAMPLES{
		\emph{xxx\_xxxxx($x$,$y$)} &
		\textbf{todo}
	}
\end{ODP}

% - position
% - velocity
% - acceleration

\lipsum[2]

\begin{ODP}{Joint limits}
	\ODPINTENT{To represent the hard limits of a joint.}
	\ODPDEFINEDIN{SOMA.owl}
	\ODPQUESTION{How far can this joint move into some direction?}
	\ODPGRAPHIC{
	\begin{tikzpicture}
	    \node[owlclass] (A) {Joint};
	    \node[owlclass,below=0.6cm of A] (B) {Joint Limit};
	    \draw (A) edge[relationxl] node[midway,label=left:hasJointLimit] {} (B);
	    \draw (B) edge[relationxr] node[midway,label=right:isLimitOfJoint] {} (A);
	\end{tikzpicture}
	}
	%% Example KnowRob language expressions
	\ODPEXAMPLES{
		\emph{xxx\_xxxxx($x$,$y$)} &
		\textbf{todo}
	}
\end{ODP}

\lipsum[2]

\begin{ODP}{Joint Positions}
	\ODPINTENT{To represent the position of a joint.}
	\ODPDEFINEDIN{SOMA.owl}
	\ODPQUESTION{What is the position of this joint?}
	\ODPGRAPHIC{
	\begin{tikzpicture}
	    \node[owlclass] (A) {Joint};
	    \node[owlclass,below=0.6cm of A] (B) {Joint Position};
	    \draw (A) edge[relationxl] node[midway,label=left:hasJointPosition] {} (B);
	    \draw (B) edge[relationxr] node[midway,label=right:isPositionOfJoint] {} (A);
	\end{tikzpicture}
	}
	%% Example KnowRob language expressions
	\ODPEXAMPLES{
		\emph{xxx\_xxxxx($x$,$y$)} &
		\textbf{todo}
	}
\end{ODP}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Dynamics}

\lipsum[2]
\todo{TODO: write about how physical attributes of objects are represented}

\begin{ODP}{Mass}
	\ODPINTENT{To represent the quantity of matter which a body contains.}
	\ODPDEFINEDIN{SOMA.owl}
	\ODPQUESTION{What is the mass of this object?}
	\ODPGRAPHIC{
	\begin{tikzpicture}
	    \node[owlclass] (A) {Physical Object};
	    \node[owlclass,below=0.6cm of A] (B) {Mass Attribute};
	    \node[data,below=0.6cm of B] (C) {xsd:double};
	    \draw (A) edge[relationxl] node[midway,label=left:hasMassAtrribute] {} (B);
	    \draw (B) edge[relationxr] node[midway,label=right:isMassAtrributeOf] {} (A);
	    \draw (B) edge[relation] node[midway,label=left:hasMassValue] {} (C);
	\end{tikzpicture}
	}
	%% Example KnowRob language expressions
	\ODPEXAMPLES{
		\emph{xxx\_xxxxx($x$,$y$)} &
		\textbf{todo}
	}
\end{ODP}

\lipsum[2]

\begin{ODP}{Friction}
	\ODPINTENT{To represent the resistance that one surface or object encounters when moving over another.}
	\ODPDEFINEDIN{SOMA.owl}
	\ODPQUESTION{What is the friction of this object?}
	\ODPGRAPHIC{
	\begin{tikzpicture}
	    \node[owlclass] (A) {Physical Object};
	    \node[owlclass,below=0.6cm of A] (B) {Friction Attribute};
	    \node[data,below=0.6cm of B] (C) {xsd:double};
	    \draw (A) edge[relationxl] node[midway,label=left:hasFrictionAtrribute] {} (B);
	    \draw (B) edge[relationxr] node[midway,label=right:isFrictionAtrributeOf] {} (A);
	    \draw (B) edge[relation] node[midway,label=left:hasFrictionValue] {} (C);
	\end{tikzpicture}
	}
	%% Example KnowRob language expressions
	\ODPEXAMPLES{
		\emph{xxx\_xxxxx($x$,$y$)} &
		\textbf{todo}
	}
\end{ODP}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Data Formats}
\label{sec:background:formats}

Representations in the \neembak may be enriched through additional data files.
Data files are stored with the \neembak, and loaded by the \ease knowledge base when a \neem is activated.
They may encode information that can be directly represented in the \neem, however, it is not necessary in such a case to duplicate the information.
A data file may be loaded at runtime, and used by the knowledge base in combination with other representations to answer questions about an activity.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{URDF}
\label{sec:background:urdf}

The Unified Robot Description Format (URDF) is widely used for the representation of kinematics in robotics. That is how objects are organized in a skeletal structure of links and joints, and how links may move relative to each other in case of being connected via a flexible joint.
URDF was designed to represent robot kinematics.
It is, however, also often used for other types of objects with movable parts, for example to represent how a door is attached to a shelve via a joint, and what limits the joint has, but can also be used to represent completely static environments (via fixed joints).
URDF further allows to represent a set of properties for links and joints, such as what the mass of a link is, or what the hard and soft limits of a joint are.

URDF organizes objects and their parts in a common coordinate system, and represents an initial configuration of all links and joints.
The origin of this coordinate system is often called \emph{world} or \emph{map} frame.
Each object has an associated frame in this coordinate system with a position relative to the parent frame in the skeletal structure.
Frame names are further used to identify entities in the knowledge base, and logged position data that corresponds to objects described in the URDF file.
To make this connection, it is important that each representation refers to the same frame names, in the same coordinate system.
\todo{more explicit: what are the properties in OWL to make the link?}

From the point of view of URDF, the world is only made of links and joints.
Joints are further classified based on how they operate, and have different sets of parameters quantifying their kinematics depending on their type.
It is, however, not possible to represent that links belong to a certain category, or that a chain of links forms a component of some type.
However, we can use the information encoded in URDF files to enrich \neembak representations, and on the other hand, use the \neembak to provide classifications for links in URDF files.

Links in URDF files may have multiple associated shapes.
Two different shape types are distinguished: collision and visualization shapes.
Each link has usually one shape of each kind.
Shapes are either represented as geometrical primitives such as spheres or boxes, or refer to an external mesh file in which case this mesh file needs to be stored as an additional data source in the \neembak (next Section).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{DAE}
\label{sec:background:dae}

The preferred format for meshes is Collada (DAE).
The reason primarly being that it is widely supported by modeling tools and rendering engines.
If possible, the mesh should be accompanied by high-resolution textures in PNG or JPG format.
The more realistic a mesh is modeled, the more immersive the experience of humans interacting with it in VR, and the better the perception models that can be trained by images generated by placing the object in a virtual scene.
\todo{what is the optimal size of meshes?}

